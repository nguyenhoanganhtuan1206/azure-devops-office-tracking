pr:
  branches:
    include:
      - features/**

resources:
- repo: self

parameters:
  - name: vmImageName
    type: string
    default: 'ubuntu-latest'

variables:
  tag: '$(Build.BuildId)'
    
  # Agent VM image name
  vmImageName: 'ubuntu-latest'
    
stages:
# - stage: Build
#   jobs:
#     - template: templates/build-app/app/templates-build-application.yml
#       parameters:
#         vmImageName: $(vmImageName)

- stage: Deploy_Dev
  displayName: 'Deploy to Dev environment'
  # dependsOn: Build
  condition: succeeded()

  jobs:
    - job: 
      steps:
        - script: |
            echo "Retrieving secrets..."
            az login --service-principal nguyenhoanganhtuan1206@gmail.com --password fullstackdevdn --tenant 9f287bec-ff90-4d47-a0ae-c98298d569aa
            echo "Creating env file..."
            echo "DB_CONNECTION_STRING=$(jq -r .DB_CONNECTION_STRING)" > .env
            cat .env
          displayName: 'Retrieving secrets and create .env file'

    # - deployment: Deploy
    #   pool:
    #     vmImage: ${{ parameters.vmImageName }}
    #   environment: test
    #   variables:
    #     - group: 'Release'
    #   strategy:
    #     runOnce:
    #       deploy:
    #         steps:
    #         - download: current 
    #           name: drop
    #           displayName: Download Artifact

    #         - script: |
    #             chmod +x /home/vsts/work/1/drop/build/libs/office-tracking-0.0.1-SNAPSHOT.jar
    #           displayName: Grant permission

    #         - task: AzureWebAppContainer@1
    #           inputs:
    #             appName: $(WebAppDev)
    #             azureSubscription: myARMServiceConnection
    #             containers: 'officetrackingcr.azurecr.io/officetrackingdocker:latest'
    #             containerCommand: 'java -jar /home/vsts/work/1/drop/build/libs/office-tracking-0.0.1-SNAPSHOT.jar'